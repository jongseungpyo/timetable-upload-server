<!-- 모바일 드로어 오버레이 -->
<div id="drawer-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden lg:hidden" onclick="closeMobileDrawer()"></div>

<!-- 데스크톱 사이드바 + 모바일 드로어 -->
<aside id="admin-sidebar" class="fixed lg:static inset-y-0 left-0 w-64 bg-white shadow-lg lg:shadow-sm border-r border-gray-200 transform -translate-x-full lg:translate-x-0 transition-transform duration-300 ease-in-out z-50 lg:z-auto min-h-screen">
    <!-- 모바일 드로어 헤더 -->
    <div class="lg:hidden flex items-center justify-between p-4 border-b border-gray-200">
        <span class="text-lg font-semibold text-gray-900">메뉴</span>
        <button onclick="closeMobileDrawer()" class="p-2 rounded-md text-gray-400 hover:text-gray-600 hover:bg-gray-100">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
        </button>
    </div>

    <nav class="p-4">
        <div class="space-y-2">
            <!-- 1. 대시보드 -->
            <a href="/admin/dashboard" id="nav-dashboard" class="admin-nav-link flex items-center px-3 py-2 text-sm font-medium text-gray-600 hover:bg-gray-50 hover:text-blue-600 rounded-md transition-all duration-200">
                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                </svg>
                대시보드
            </a>

            <!-- 2. 제출검토 (아코디언) -->
            <div class="space-y-1">
                <button onclick="toggleAccordion('submissions')" id="nav-submissions" class="admin-nav-link flex items-center justify-between w-full px-3 py-2 text-sm font-medium text-gray-600 hover:bg-gray-50 hover:text-blue-600 rounded-md transition-all duration-200">
                    <div class="flex items-center">
                        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v8a2 2 0 002 2h8a2 2 0 002-2v-8a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                        </svg>
                        제출검토
                    </div>
                    <svg id="submissions-icon" class="w-4 h-4 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                    </svg>
                </button>
                <div id="submissions-accordion" class="ml-8 space-y-1 overflow-hidden transition-all duration-300 ease-in-out max-h-0">
                    <a href="/admin/submissions" class="flex items-center px-3 py-2 text-sm text-gray-600 hover:bg-blue-50 hover:text-blue-600 rounded-md transition-colors">
                        📝 미검토 시간표
                    </a>
                    <a href="/admin/submissions?tab=approved" class="flex items-center px-3 py-2 text-sm text-gray-600 hover:bg-green-50 hover:text-green-600 rounded-md transition-colors">
                        ✅ 승인된 시간표
                    </a>
                    <a href="/admin/submissions?tab=rejected" class="flex items-center px-3 py-2 text-sm text-gray-600 hover:bg-red-50 hover:text-red-600 rounded-md transition-colors">
                        ❌ 거절된 시간표
                    </a>
                </div>
            </div>

            <!-- 3. 학원 가입 승인 -->
            <a href="/admin/academies" id="nav-academies" class="admin-nav-link flex items-center px-3 py-2 text-sm font-medium text-gray-600 hover:bg-gray-50 hover:text-blue-600 rounded-md transition-all duration-200">
                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                </svg>
                학원 가입 승인
            </a>

            <!-- 4. 번들 관리 (아코디언) -->
            <div class="space-y-1">
                <button onclick="toggleAccordion('bundles')" id="nav-bundles" class="admin-nav-link flex items-center justify-between w-full px-3 py-2 text-sm font-medium text-gray-600 hover:bg-gray-50 hover:text-blue-600 rounded-md transition-all duration-200">
                    <div class="flex items-center">
                        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 7a2 2 0 012-2h10a2 2 0 012 2v2M7 7h10"/>
                        </svg>
                        번들 관리
                    </div>
                    <svg id="bundles-icon" class="w-4 h-4 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                    </svg>
                </button>
                <div id="bundles-accordion" class="ml-8 space-y-1 overflow-hidden transition-all duration-300 ease-in-out max-h-0">
                    <a href="/admin/bundles" class="flex items-center px-3 py-2 text-sm text-gray-600 hover:bg-blue-50 hover:text-blue-600 rounded-md transition-colors">
                        📦 승인된 번들
                    </a>
                    <a href="/admin/current_bundles" class="flex items-center px-3 py-2 text-sm text-gray-600 hover:bg-purple-50 hover:text-purple-600 rounded-md transition-colors">
                        📊 번들 현황
                    </a>
                </div>
            </div>

            <!-- 5. 직접 업로드 -->
            <a href="/direct-upload" id="nav-direct-upload" class="admin-nav-link flex items-center px-3 py-2 text-sm font-medium text-gray-600 hover:bg-gray-50 hover:text-blue-600 rounded-md transition-all duration-200">
                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                </svg>
                직접 업로드
            </a>
        </div>
    </nav>
</aside>

<script>
    // 모바일 드로어 열기
    function openMobileDrawer() {
        document.getElementById('admin-sidebar').classList.remove('-translate-x-full');
        document.getElementById('drawer-overlay').classList.remove('hidden');
        document.body.style.overflow = 'hidden'; // 스크롤 방지
    }

    // 모바일 드로어 닫기
    function closeMobileDrawer() {
        document.getElementById('admin-sidebar').classList.add('-translate-x-full');
        document.getElementById('drawer-overlay').classList.add('hidden');
        document.body.style.overflow = 'auto'; // 스크롤 복원
    }

    // 아코디언 토글 함수 (부드러운 애니메이션)
    function toggleAccordion(section) {
        const accordion = document.getElementById(`${section}-accordion`);
        const icon = document.getElementById(`${section}-icon`);
        
        if (accordion.style.maxHeight === '0px' || !accordion.style.maxHeight) {
            // 열기
            accordion.style.maxHeight = accordion.scrollHeight + 'px';
            icon.style.transform = 'rotate(180deg)';
        } else {
            // 닫기
            accordion.style.maxHeight = '0px';
            icon.style.transform = 'rotate(0deg)';
        }
    }

    // 페이지별 활성 상태 설정
    function setActiveNavigation() {
        const currentPath = window.location.pathname;
        const currentSearch = window.location.search;
        
        // 모든 네비게이션 아이템 기본 상태로 초기화
        document.querySelectorAll('.admin-nav-link').forEach(link => {
            link.classList.remove('active', 'bg-blue-50', 'text-blue-600', 'border-l-4', 'border-blue-500');
            link.classList.add('text-gray-600');
        });

        // 현재 페이지에 따라 활성 상태 설정 및 아코디언 열기
        if (currentPath === '/admin/dashboard') {
            document.getElementById('nav-dashboard').classList.add('active', 'bg-blue-50', 'text-blue-600', 'border-l-4', 'border-blue-500');
            document.getElementById('nav-dashboard').classList.remove('text-gray-600');
        } else if (currentPath === '/admin/submissions') {
            document.getElementById('nav-submissions').classList.add('active', 'bg-blue-50', 'text-blue-600', 'border-l-4', 'border-blue-500');
            document.getElementById('nav-submissions').classList.remove('text-gray-600');
            // 제출검토 아코디언 자동 열기
            setTimeout(() => toggleAccordion('submissions'), 100);
        } else if (currentPath === '/admin/academies') {
            document.getElementById('nav-academies').classList.add('active', 'bg-blue-50', 'text-blue-600', 'border-l-4', 'border-blue-500');
            document.getElementById('nav-academies').classList.remove('text-gray-600');
        } else if (currentPath === '/admin/bundles' || currentPath === '/admin/current_bundles') {
            document.getElementById('nav-bundles').classList.add('active', 'bg-blue-50', 'text-blue-600', 'border-l-4', 'border-blue-500');
            document.getElementById('nav-bundles').classList.remove('text-gray-600');
            // 번들관리 아코디언 자동 열기
            setTimeout(() => toggleAccordion('bundles'), 100);
        } else if (currentPath === '/direct-upload') {
            document.getElementById('nav-direct-upload').classList.add('active', 'bg-blue-50', 'text-blue-600', 'border-l-4', 'border-blue-500');
            document.getElementById('nav-direct-upload').classList.remove('text-gray-600');
        }
    }

    // 페이지 로드 시 활성 네비게이션 설정
    document.addEventListener('DOMContentLoaded', () => {
        setActiveNavigation();
    });

</script>